package com.mvc.jigulyeog.model.dao;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.mybatis.spring.SqlSessionTemplate;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;

import com.mvc.jigulyeog.model.dto.CommunityGuestbookDto;
import com.mvc.jigulyeog.model.dto.CommunityNoticeDto;
import com.mvc.jigulyeog.model.dto.ProjectDto;
import com.mvc.jigulyeog.model.dto.UserDto;

@Repository
public class CommunityDaoImpl implements CommunityDao{
	Logger logger = LoggerFactory.getLogger(CommunityDaoImpl.class);
	
	@Autowired
	SqlSessionTemplate sqlSession;
	
	@Override
	public Boolean createCommunity(Integer pro_num) {
		logger.info("[ CommunityDao : createCommunity ]");
		int res = 0;
		
		try {
			res = sqlSession.insert(NAMESPACE+"createCommunity",pro_num);
		} catch (Exception e) {
			logger.info("[ CommunityDao error : createCommunity ]");
			e.getStackTrace();
		}
		
		return (res>0)?true:false;
	}

	@Override
	public Boolean checkCommunity(Integer pro_num) {
		logger.info("[ CommunityDao : checkCommunity ]");
		Integer res = 0;
		
		try {
			res = sqlSession.selectOne(NAMESPACE+"checkCommunity",pro_num);
		} catch (Exception e) {
			logger.info("[ CommunityDao error : checkCommunity ]");
			e.getStackTrace();
		}
		
		return (res!=null)?true:false;
	}

	@Override
	public List<UserDto> fundingUserList(int pro_num) {
		logger.info("[ CommunityDao : fundingUserList ]");
		List<UserDto> fundingUserList = new ArrayList<UserDto>();
		
		try {
			fundingUserList = sqlSession.selectList(NAMESPACE+"fundingUser",pro_num);
			
		} catch (Exception e) {
			logger.info("[ CommunityDao error : fundingUserList ]");
			e.printStackTrace();
		}
		return fundingUserList;
	}

	@Override
	public int getCommunityNo(int pro_num) {
		logger.info("[ CommunityDao : checkCommunity ]");
		Integer commNo = 0;
		
		try {
			commNo = sqlSession.selectOne(NAMESPACE+"checkCommunity",pro_num);
		} catch (Exception e) {
			logger.info("[ CommunityDao error : checkCommunity ]");
			e.getStackTrace();
		}
		
		return commNo;
	}

	@Override
	public Boolean commNoticeWrite(CommunityNoticeDto notice) {
		logger.info("[ CommunityDao : commNoticeWrite ]");
		int res = 0;
		try {
			res = sqlSession.insert(NAMESPACE+"noticeWrite",notice);
		} catch (Exception e) {
			logger.info("[ CommunityDao error : commNoticeWrite ]");
			e.getStackTrace();
		}
		
		return (res>0)?true:false;
	}

	@Override
	public int totalNotice() {
		logger.info("[ CommunityDao : totalNotice ]");
		int totalNotice = 0;
		
		try {
			totalNotice = sqlSession.selectOne(NAMESPACE+"totalNotice");
		}catch (Exception e) {
			logger.info("[ error :totalNotice ]");
			e.getStackTrace();
		}
		logger.info("[ totalNotice : "+totalNotice+"]");
		return totalNotice;
	}

	@Override
	public List<CommunityNoticeDto> getNoticeList(int startRow, int endRow) {
		logger.info("[ CommunityDao : getNoticeList ]");
		List<CommunityNoticeDto> getNoticeList = new ArrayList<CommunityNoticeDto>();
		
		Map<String,Integer> param = new HashMap<String,Integer>();
		
		param.put("startRow", startRow);
		param.put("endRow", endRow);
		
		try {
			getNoticeList = sqlSession.selectList(NAMESPACE+"getNoticeList",param);
		}catch (Exception e) {
			logger.info("[ error : getNoticeList ]");
			e.getStackTrace();
		}
		
		logger.info("[ getNoticeList : "+getNoticeList.size()+" ]");
		
		
		return getNoticeList;
	}

	@Override
	public CommunityNoticeDto getNoticeOne(Integer notice_num) {
		logger.info("[ CommunityDao : getNoticeOne ]");
		CommunityNoticeDto notice = new CommunityNoticeDto();
		try {
			notice = sqlSession.selectOne(NAMESPACE+"getNoticeOne",notice_num);
		} catch (Exception e) {
			logger.info("[ error : getNoticeOne ]");
			e.getStackTrace();
		}
		
		return notice;
	}

	@Override
	public Boolean commNoticeUpdate(CommunityNoticeDto notice) {
		logger.info("[ CommunityDao : commNoticeUpdate ]");
		int res = 0;
		try {
			res = sqlSession.update(NAMESPACE+"noticeUpdate",notice);
		} catch (Exception e) {
			logger.info("[ error : commNoticeUpdate ]");
			e.getStackTrace();
		}
		return (res>0)?true:false;
	}
	
	@Override
	public void countViewNotice(Integer notice_num) {
		logger.info("[ CommunityDao : countViewNotice ]");
		
		try {
			int res = sqlSession.update(NAMESPACE+"countViewNotice",notice_num);
			if(res>0) {logger.info("[ Success counting view notice ]");}
			
		} catch (Exception e) {
			logger.info("[ CommunityDao error : countViewNotice ]");
		}
		
	}

	@Override
	public List<CommunityGuestbookDto> getGuestbookListList(int startRow, int endRow) {
		logger.info("[ CommunityDao : getGuestbookList ]");
		List<CommunityNoticeDto> getNoticeList = new ArrayList<CommunityNoticeDto>();
		
		Map<String,Integer> param = new HashMap<String,Integer>();
		
		param.put("startRow", startRow);
		param.put("endRow", endRow);
		
		try {
			getNoticeList = sqlSession.selectList(NAMESPACE+"getNoticeList",param);
		}catch (Exception e) {
			logger.info("[ error : getNoticeList ]");
			e.getStackTrace();
		}
		
		logger.info("[ getNoticeList : "+getNoticeList.size()+" ]");
		
		
		return getNoticeList;
	}
	

}
